-----------------------------------
-- Sub Queries 
-----------------------------------

SELECT * FROM user_tables; -- all tables the belong to our current db/schema 
SELECT DISTINCT owner FROM all_tables 

-----------------------------------
-- Sub Queries in WHERE 
-----------------------------------

-----------------------------------
-- Single Row SQs
-----------------------------------

SELECT * FROM products;

-- Which products cost more than product number 2 
-- 1. What is the price of product number 2 ? 
SELECT unitPrice FROM products WHERE productID = 2; --19
-- 2. Which prices cost more than this price ? 
SELECT productName, unitPrice FROM products WHERE unitPrice > 19 ; 

SELECT productName, unitPrice 
FROM products 
WHERE unitPrice > (SELECT unitPrice FROM products WHERE productID = 2) ; 

-- Which products are supplied by the same supplier that delivers Chai
-- Who's supplying Chai (supplier_id)
-- Which products are supplied by the same supplier 

SELECT * 
FROM products 
WHERE supplierID = (SELECT supplierID FROM products WHERE productName = 'Chai');

-- The SQ should be placed on the right side of the equation
SELECT * 
FROM products 
WHERE (SELECT supplierID FROM products WHERE productName = 'Chai') = supplierID;

-- The SQ must be enclosed within single quotes 
SELECT * 
FROM products 
WHERE supplierID = SELECT supplierID FROM products WHERE productName = 'Chai';

-- Which products cost more than the average ? 
SELECT productName, unitPrice 
FROM products 
WHERE unitPrice > (SELECT AVG(unitPrice) FROM products);


-- Which products belong to the Seafood category ? 
SELECT * FROM products 
SELECT * FROM categories 

-- What is the catid of Seafood ? (categories)
-- Which products belong to the same catid ? (products)

SELECT productName, unitPrice, categoryID 
FROM products 
WHERE categoryID = (SELECT categoryID FROM categories WHERE categoryName = 'Seafood');

-- Limitations 
-- * The SQ must return a single row 
SELECT productName, unitPrice 
FROM products 
WHERE unitPrice = (SELECT unitPrice FROM products WHERE productID IN (2,3,5,7,9)) ; 

-- * The SQ must return a single field 
SELECT productName, unitPrice 
FROM products 
WHERE unitPrice > (SELECT productName, unitPrice FROM products WHERE productID = 2) ; 

-----------------------------------
-- Multiple Row SQs
-----------------------------------

-- IN
SELECT productName, categoryID, unitPrice 
FROM products 
WHERE unitPrice IN (SELECT unitPrice FROM products WHERE categoryId = 1) ; 

-- Greater / Less than group of values (MAX / MIN)
SELECT productName, categoryID, unitPrice 
FROM products 
WHERE unitPrice > (SELECT MAX(unitPrice) FROM products WHERE categoryId = 2) ; 

SELECT productName, categoryID, unitPrice 
FROM products 
WHERE unitPrice < (SELECT MIN(unitPrice) FROM products WHERE categoryId = 2) ; 

-----------------------------------
-- Sub Queries in SELECT 
-----------------------------------

SELECT productID, productName, unitPrice, AVG(unitPrice) AS "AvgPrice"
FROM products;

SELECT productID, productName, unitPrice, 
       (SELECT AVG(unitPrice) FROM products) AS "AvgPrice"
FROM products;

SELECT productID, productName, unitPrice, AVG(unitPrice) OVER () AS "AvgPrice"
FROM products;

SELECT productID, productName, unitPrice, categoryID,
        AVG(unitPrice) OVER (PARTITION BY categoryID) AS "AvgPrice"
FROM products
ORDER BY categoryID;

-----------------------------------
-- Sub Queries in FROM  
-----------------------------------

SELECT * 
FROM (SELECT productName, unitPrice FROM products);

SELECT AVG(MAX(unitPrice)) FROM products GROUP BY supplierID 

SELECT AVG("MaxPrice") FROM 
    (SELECT MAX(unitPrice) AS "MaxPrice" FROM products GROUP BY supplierID )
